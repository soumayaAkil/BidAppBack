"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _index = _interopRequireDefault(require("./index"));

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class App {
  /**
   * Provides access to the `applications` version 2 endpoint.
   */
  static get PATH() {
    return "/v2/applications";
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Addition App options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options; // Used to facilitate testing of the call to the underlying object

    this._vonage = this.options.vonageOverride || _index.default;
  }

  _convertMethodSignature(name, type, answerUrl, eventUrl, options) {
    var capability = {};

    switch (type) {
      case "voice":
        capability = {
          voice: {
            webhooks: {
              answer_url: {
                address: answerUrl,
                http_method: "GET"
              },
              event_url: {
                address: eventUrl,
                http_method: "POST"
              }
            }
          }
        };
        break;

      case "messages":
        capability = {
          messages: {
            webhooks: {
              inbound_url: {
                address: options.inbound_url,
                http_method: "POST"
              },
              status_url: {
                address: options.status_url,
                http_method: "POST"
              }
            }
          }
        };
        break;

      case "rtc":
        capability = {
          rtc: {
            webhooks: {
              event_url: {
                address: eventUrl,
                http_method: "POST"
              }
            }
          }
        };
        break;
    }

    return {
      name: name,
      capabilities: capability
    };
  }

  _convertApplicationResponse(application) {
    for (var capability in application.capabilities) {
      application[capability] = {
        webhooks: []
      };

      for (var webhook in application.capabilities[capability].webhooks) {
        application[capability].webhooks.push({
          endpoint_type: webhook,
          endpoint: application.capabilities[capability].webhooks[webhook].address,
          http_method: application.capabilities[capability].webhooks[webhook].http_method
        });
      }
    }

    delete application.capabilities;
    return application;
  }

  _convertApplicationListResponse(applicationResponseHandler) {
    return response => {
      response.count = response.total_items;
      response.page_index = response.page;

      for (var i in response._embedded.applications) {
        response._embedded.applications[i] = applicationResponseHandler(response._embedded.applications[i]);
      }

      return response;
    };
  }
  /**
   * TODO: document
   */


  create(name, type, answerUrl, eventUrl, options, callback) {
    var params = {};
    var responseParser = null;

    if (arguments.length > 2) {
      params = JSON.stringify(this._convertMethodSignature(name, type, answerUrl, eventUrl, options));
      responseParser = this._convertApplicationResponse;
    } else {
      params = JSON.stringify(name);
      callback = type;
    }

    var authorization = "".concat(this.creds.apiKey, ":").concat(this.creds.apiSecret);
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: App.PATH,
      method: "POST",
      body: params,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Basic ".concat(Buffer.from(authorization).toString("base64"))
      }
    };
    this.options.httpClient.request(config, callback, callback, false, responseParser);
  }
  /**
   * TODO: document
   */


  get(params, callback) {
    var v2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var authorization = "".concat(this.creds.apiKey, ":").concat(this.creds.apiSecret);
    var responseParser = null;

    if (typeof params !== "object") {
      responseParser = this._convertApplicationResponse;
    } else {
      responseParser = this._convertApplicationListResponse(this._convertApplicationResponse);
    }

    if (v2) {
      responseParser = null;
    }

    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: _Utils.default.createPathWithQuery(App.PATH, params),
      method: "GET",
      body: undefined,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Basic ".concat(Buffer.from(authorization).toString("base64"))
      }
    };
    this.options.httpClient.request(config, callback, callback, false, responseParser);
  }
  /**
   * TODO: document
   */


  update(appId, name, type, answerUrl, eventUrl, options, callback) {
    var params = {};
    var responseParser = null;

    if (arguments.length > 3) {
      params = JSON.stringify(this._convertMethodSignature(name, type, answerUrl, eventUrl, options));
      responseParser = this._convertApplicationResponse;
    } else {
      params = JSON.stringify(name);
      callback = type;
    }

    var authorization = "".concat(this.creds.apiKey, ":").concat(this.creds.apiSecret);
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: "".concat(App.PATH, "/").concat(appId),
      method: "PUT",
      body: params,
      headers: {
        "Content-Type": "application/json",
        Authorization: "Basic ".concat(Buffer.from(authorization).toString("base64"))
      }
    };
    this.options.httpClient.request(config, callback, callback, false, responseParser);
  }
  /**
   * TODO: document
   */


  delete(appId, callback) {
    var authorization = "".concat(this.creds.apiKey, ":").concat(this.creds.apiSecret);
    var config = {
      host: this.options.apiHost || "api.nexmo.com",
      path: "".concat(App.PATH, "/").concat(appId),
      method: "DELETE",
      body: "{}",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Basic ".concat(Buffer.from(authorization).toString("base64"))
      }
    };
    this.options.httpClient.request(config, callback);
  }

}

var _default = App;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBcHAiLCJQQVRIIiwiY29uc3RydWN0b3IiLCJjcmVkZW50aWFscyIsIm9wdGlvbnMiLCJjcmVkcyIsIl92b25hZ2UiLCJ2b25hZ2VPdmVycmlkZSIsInZvbmFnZSIsIl9jb252ZXJ0TWV0aG9kU2lnbmF0dXJlIiwibmFtZSIsInR5cGUiLCJhbnN3ZXJVcmwiLCJldmVudFVybCIsImNhcGFiaWxpdHkiLCJ2b2ljZSIsIndlYmhvb2tzIiwiYW5zd2VyX3VybCIsImFkZHJlc3MiLCJodHRwX21ldGhvZCIsImV2ZW50X3VybCIsIm1lc3NhZ2VzIiwiaW5ib3VuZF91cmwiLCJzdGF0dXNfdXJsIiwicnRjIiwiY2FwYWJpbGl0aWVzIiwiX2NvbnZlcnRBcHBsaWNhdGlvblJlc3BvbnNlIiwiYXBwbGljYXRpb24iLCJ3ZWJob29rIiwicHVzaCIsImVuZHBvaW50X3R5cGUiLCJlbmRwb2ludCIsIl9jb252ZXJ0QXBwbGljYXRpb25MaXN0UmVzcG9uc2UiLCJhcHBsaWNhdGlvblJlc3BvbnNlSGFuZGxlciIsInJlc3BvbnNlIiwiY291bnQiLCJ0b3RhbF9pdGVtcyIsInBhZ2VfaW5kZXgiLCJwYWdlIiwiaSIsIl9lbWJlZGRlZCIsImFwcGxpY2F0aW9ucyIsImNyZWF0ZSIsImNhbGxiYWNrIiwicGFyYW1zIiwicmVzcG9uc2VQYXJzZXIiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwiYXV0aG9yaXphdGlvbiIsImFwaUtleSIsImFwaVNlY3JldCIsImNvbmZpZyIsImhvc3QiLCJhcGlIb3N0IiwicGF0aCIsIm1ldGhvZCIsImJvZHkiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImh0dHBDbGllbnQiLCJyZXF1ZXN0IiwiZ2V0IiwidjIiLCJVdGlscyIsImNyZWF0ZVBhdGhXaXRoUXVlcnkiLCJ1bmRlZmluZWQiLCJ1cGRhdGUiLCJhcHBJZCIsImRlbGV0ZSJdLCJzb3VyY2VzIjpbIi4uL3NyYy9BcHAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB2b25hZ2UgZnJvbSBcIi4vaW5kZXhcIjtcbmltcG9ydCBVdGlscyBmcm9tIFwiLi9VdGlsc1wiO1xuXG5jbGFzcyBBcHAge1xuICAvKipcbiAgICogUHJvdmlkZXMgYWNjZXNzIHRvIHRoZSBgYXBwbGljYXRpb25zYCB2ZXJzaW9uIDIgZW5kcG9pbnQuXG4gICAqL1xuICBzdGF0aWMgZ2V0IFBBVEgoKSB7XG4gICAgcmV0dXJuIFwiL3YyL2FwcGxpY2F0aW9uc1wiO1xuICB9XG4gIC8qKlxuICAgKiBAcGFyYW0ge0NyZWRlbnRpYWxzfSBjcmVkZW50aWFsc1xuICAgKiAgICBjcmVkZW50aWFscyB0byBiZSB1c2VkIHdoZW4gaW50ZXJhY3Rpbmcgd2l0aCB0aGUgQVBJLlxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgKiAgICBBZGRpdGlvbiBBcHAgb3B0aW9ucy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLmNyZWRzID0gY3JlZGVudGlhbHM7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcblxuICAgIC8vIFVzZWQgdG8gZmFjaWxpdGF0ZSB0ZXN0aW5nIG9mIHRoZSBjYWxsIHRvIHRoZSB1bmRlcmx5aW5nIG9iamVjdFxuICAgIHRoaXMuX3ZvbmFnZSA9IHRoaXMub3B0aW9ucy52b25hZ2VPdmVycmlkZSB8fCB2b25hZ2U7XG4gIH1cblxuICBfY29udmVydE1ldGhvZFNpZ25hdHVyZShuYW1lLCB0eXBlLCBhbnN3ZXJVcmwsIGV2ZW50VXJsLCBvcHRpb25zKSB7XG4gICAgbGV0IGNhcGFiaWxpdHkgPSB7fTtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgXCJ2b2ljZVwiOlxuICAgICAgICBjYXBhYmlsaXR5ID0ge1xuICAgICAgICAgIHZvaWNlOiB7XG4gICAgICAgICAgICB3ZWJob29rczoge1xuICAgICAgICAgICAgICBhbnN3ZXJfdXJsOiB7XG4gICAgICAgICAgICAgICAgYWRkcmVzczogYW5zd2VyVXJsLFxuICAgICAgICAgICAgICAgIGh0dHBfbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBldmVudF91cmw6IHtcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBldmVudFVybCxcbiAgICAgICAgICAgICAgICBodHRwX21ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1lc3NhZ2VzXCI6XG4gICAgICAgIGNhcGFiaWxpdHkgPSB7XG4gICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgIHdlYmhvb2tzOiB7XG4gICAgICAgICAgICAgIGluYm91bmRfdXJsOiB7XG4gICAgICAgICAgICAgICAgYWRkcmVzczogb3B0aW9ucy5pbmJvdW5kX3VybCxcbiAgICAgICAgICAgICAgICBodHRwX21ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHN0YXR1c191cmw6IHtcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBvcHRpb25zLnN0YXR1c191cmwsXG4gICAgICAgICAgICAgICAgaHR0cF9tZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJydGNcIjpcbiAgICAgICAgY2FwYWJpbGl0eSA9IHtcbiAgICAgICAgICBydGM6IHtcbiAgICAgICAgICAgIHdlYmhvb2tzOiB7XG4gICAgICAgICAgICAgIGV2ZW50X3VybDoge1xuICAgICAgICAgICAgICAgIGFkZHJlc3M6IGV2ZW50VXJsLFxuICAgICAgICAgICAgICAgIGh0dHBfbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBjYXBhYmlsaXRpZXM6IGNhcGFiaWxpdHksXG4gICAgfTtcbiAgfVxuXG4gIF9jb252ZXJ0QXBwbGljYXRpb25SZXNwb25zZShhcHBsaWNhdGlvbikge1xuICAgIGZvciAobGV0IGNhcGFiaWxpdHkgaW4gYXBwbGljYXRpb24uY2FwYWJpbGl0aWVzKSB7XG4gICAgICBhcHBsaWNhdGlvbltjYXBhYmlsaXR5XSA9IHtcbiAgICAgICAgd2ViaG9va3M6IFtdLFxuICAgICAgfTtcbiAgICAgIGZvciAobGV0IHdlYmhvb2sgaW4gYXBwbGljYXRpb24uY2FwYWJpbGl0aWVzW2NhcGFiaWxpdHldLndlYmhvb2tzKSB7XG4gICAgICAgIGFwcGxpY2F0aW9uW2NhcGFiaWxpdHldLndlYmhvb2tzLnB1c2goe1xuICAgICAgICAgIGVuZHBvaW50X3R5cGU6IHdlYmhvb2ssXG4gICAgICAgICAgZW5kcG9pbnQ6XG4gICAgICAgICAgICBhcHBsaWNhdGlvbi5jYXBhYmlsaXRpZXNbY2FwYWJpbGl0eV0ud2ViaG9va3Nbd2ViaG9va10uYWRkcmVzcyxcbiAgICAgICAgICBodHRwX21ldGhvZDpcbiAgICAgICAgICAgIGFwcGxpY2F0aW9uLmNhcGFiaWxpdGllc1tjYXBhYmlsaXR5XS53ZWJob29rc1t3ZWJob29rXS5odHRwX21ldGhvZCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGVsZXRlIGFwcGxpY2F0aW9uLmNhcGFiaWxpdGllcztcbiAgICByZXR1cm4gYXBwbGljYXRpb247XG4gIH1cblxuICBfY29udmVydEFwcGxpY2F0aW9uTGlzdFJlc3BvbnNlKGFwcGxpY2F0aW9uUmVzcG9uc2VIYW5kbGVyKSB7XG4gICAgcmV0dXJuIChyZXNwb25zZSkgPT4ge1xuICAgICAgcmVzcG9uc2UuY291bnQgPSByZXNwb25zZS50b3RhbF9pdGVtcztcbiAgICAgIHJlc3BvbnNlLnBhZ2VfaW5kZXggPSByZXNwb25zZS5wYWdlO1xuICAgICAgZm9yIChsZXQgaSBpbiByZXNwb25zZS5fZW1iZWRkZWQuYXBwbGljYXRpb25zKSB7XG4gICAgICAgIHJlc3BvbnNlLl9lbWJlZGRlZC5hcHBsaWNhdGlvbnNbaV0gPSBhcHBsaWNhdGlvblJlc3BvbnNlSGFuZGxlcihcbiAgICAgICAgICByZXNwb25zZS5fZW1iZWRkZWQuYXBwbGljYXRpb25zW2ldXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRPRE86IGRvY3VtZW50XG4gICAqL1xuICBjcmVhdGUobmFtZSwgdHlwZSwgYW5zd2VyVXJsLCBldmVudFVybCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBsZXQgcGFyYW1zID0ge307XG4gICAgbGV0IHJlc3BvbnNlUGFyc2VyID0gbnVsbDtcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMikge1xuICAgICAgcGFyYW1zID0gSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHRoaXMuX2NvbnZlcnRNZXRob2RTaWduYXR1cmUobmFtZSwgdHlwZSwgYW5zd2VyVXJsLCBldmVudFVybCwgb3B0aW9ucylcbiAgICAgICk7XG4gICAgICByZXNwb25zZVBhcnNlciA9IHRoaXMuX2NvbnZlcnRBcHBsaWNhdGlvblJlc3BvbnNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJhbXMgPSBKU09OLnN0cmluZ2lmeShuYW1lKTtcbiAgICAgIGNhbGxiYWNrID0gdHlwZTtcbiAgICB9XG5cbiAgICBjb25zdCBhdXRob3JpemF0aW9uID0gYCR7dGhpcy5jcmVkcy5hcGlLZXl9OiR7dGhpcy5jcmVkcy5hcGlTZWNyZXR9YDtcblxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgIHBhdGg6IEFwcC5QQVRILFxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IHBhcmFtcyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCYXNpYyAke0J1ZmZlci5mcm9tKGF1dGhvcml6YXRpb24pLnRvU3RyaW5nKFwiYmFzZTY0XCIpfWAsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgY29uZmlnLFxuICAgICAgY2FsbGJhY2ssXG4gICAgICBjYWxsYmFjayxcbiAgICAgIGZhbHNlLFxuICAgICAgcmVzcG9uc2VQYXJzZXJcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFRPRE86IGRvY3VtZW50XG4gICAqL1xuICBnZXQocGFyYW1zLCBjYWxsYmFjaywgdjIgPSBmYWxzZSkge1xuICAgIGNvbnN0IGF1dGhvcml6YXRpb24gPSBgJHt0aGlzLmNyZWRzLmFwaUtleX06JHt0aGlzLmNyZWRzLmFwaVNlY3JldH1gO1xuICAgIGxldCByZXNwb25zZVBhcnNlciA9IG51bGw7XG5cbiAgICBpZiAodHlwZW9mIHBhcmFtcyAhPT0gXCJvYmplY3RcIikge1xuICAgICAgcmVzcG9uc2VQYXJzZXIgPSB0aGlzLl9jb252ZXJ0QXBwbGljYXRpb25SZXNwb25zZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzcG9uc2VQYXJzZXIgPSB0aGlzLl9jb252ZXJ0QXBwbGljYXRpb25MaXN0UmVzcG9uc2UoXG4gICAgICAgIHRoaXMuX2NvbnZlcnRBcHBsaWNhdGlvblJlc3BvbnNlXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICh2Mikge1xuICAgICAgcmVzcG9uc2VQYXJzZXIgPSBudWxsO1xuICAgIH1cblxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgIHBhdGg6IFV0aWxzLmNyZWF0ZVBhdGhXaXRoUXVlcnkoQXBwLlBBVEgsIHBhcmFtcyksXG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBib2R5OiB1bmRlZmluZWQsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmFzaWMgJHtCdWZmZXIuZnJvbShhdXRob3JpemF0aW9uKS50b1N0cmluZyhcImJhc2U2NFwiKX1gLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChcbiAgICAgIGNvbmZpZyxcbiAgICAgIGNhbGxiYWNrLFxuICAgICAgY2FsbGJhY2ssXG4gICAgICBmYWxzZSxcbiAgICAgIHJlc3BvbnNlUGFyc2VyXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgdXBkYXRlKGFwcElkLCBuYW1lLCB0eXBlLCBhbnN3ZXJVcmwsIGV2ZW50VXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIGxldCBwYXJhbXMgPSB7fTtcbiAgICBsZXQgcmVzcG9uc2VQYXJzZXIgPSBudWxsO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMykge1xuICAgICAgcGFyYW1zID0gSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgIHRoaXMuX2NvbnZlcnRNZXRob2RTaWduYXR1cmUobmFtZSwgdHlwZSwgYW5zd2VyVXJsLCBldmVudFVybCwgb3B0aW9ucylcbiAgICAgICk7XG4gICAgICByZXNwb25zZVBhcnNlciA9IHRoaXMuX2NvbnZlcnRBcHBsaWNhdGlvblJlc3BvbnNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJhbXMgPSBKU09OLnN0cmluZ2lmeShuYW1lKTtcbiAgICAgIGNhbGxiYWNrID0gdHlwZTtcbiAgICB9XG5cbiAgICBjb25zdCBhdXRob3JpemF0aW9uID0gYCR7dGhpcy5jcmVkcy5hcGlLZXl9OiR7dGhpcy5jcmVkcy5hcGlTZWNyZXR9YDtcblxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgIHBhdGg6IGAke0FwcC5QQVRIfS8ke2FwcElkfWAsXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBib2R5OiBwYXJhbXMsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmFzaWMgJHtCdWZmZXIuZnJvbShhdXRob3JpemF0aW9uKS50b1N0cmluZyhcImJhc2U2NFwiKX1gLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChcbiAgICAgIGNvbmZpZyxcbiAgICAgIGNhbGxiYWNrLFxuICAgICAgY2FsbGJhY2ssXG4gICAgICBmYWxzZSxcbiAgICAgIHJlc3BvbnNlUGFyc2VyXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgZGVsZXRlKGFwcElkLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IGF1dGhvcml6YXRpb24gPSBgJHt0aGlzLmNyZWRzLmFwaUtleX06JHt0aGlzLmNyZWRzLmFwaVNlY3JldH1gO1xuXG4gICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgIGhvc3Q6IHRoaXMub3B0aW9ucy5hcGlIb3N0IHx8IFwiYXBpLm5leG1vLmNvbVwiLFxuICAgICAgcGF0aDogYCR7QXBwLlBBVEh9LyR7YXBwSWR9YCxcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGJvZHk6IFwie31cIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCYXNpYyAke0J1ZmZlci5mcm9tKGF1dGhvcml6YXRpb24pLnRvU3RyaW5nKFwiYmFzZTY0XCIpfWAsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KGNvbmZpZywgY2FsbGJhY2spO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwcDtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7QUFFQTs7QUFDQTs7OztBQUVBLE1BQU1BLEdBQU4sQ0FBVTtFQUNSO0FBQ0Y7QUFDQTtFQUNpQixXQUFKQyxJQUFJLEdBQUc7SUFDaEIsT0FBTyxrQkFBUDtFQUNEO0VBQ0Q7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7RUFDRUMsV0FBVyxDQUFDQyxXQUFELEVBQTRCO0lBQUEsSUFBZEMsT0FBYyx1RUFBSixFQUFJO0lBQ3JDLEtBQUtDLEtBQUwsR0FBYUYsV0FBYjtJQUNBLEtBQUtDLE9BQUwsR0FBZUEsT0FBZixDQUZxQyxDQUlyQzs7SUFDQSxLQUFLRSxPQUFMLEdBQWUsS0FBS0YsT0FBTCxDQUFhRyxjQUFiLElBQStCQyxjQUE5QztFQUNEOztFQUVEQyx1QkFBdUIsQ0FBQ0MsSUFBRCxFQUFPQyxJQUFQLEVBQWFDLFNBQWIsRUFBd0JDLFFBQXhCLEVBQWtDVCxPQUFsQyxFQUEyQztJQUNoRSxJQUFJVSxVQUFVLEdBQUcsRUFBakI7O0lBQ0EsUUFBUUgsSUFBUjtNQUNFLEtBQUssT0FBTDtRQUNFRyxVQUFVLEdBQUc7VUFDWEMsS0FBSyxFQUFFO1lBQ0xDLFFBQVEsRUFBRTtjQUNSQyxVQUFVLEVBQUU7Z0JBQ1ZDLE9BQU8sRUFBRU4sU0FEQztnQkFFVk8sV0FBVyxFQUFFO2NBRkgsQ0FESjtjQUtSQyxTQUFTLEVBQUU7Z0JBQ1RGLE9BQU8sRUFBRUwsUUFEQTtnQkFFVE0sV0FBVyxFQUFFO2NBRko7WUFMSDtVQURMO1FBREksQ0FBYjtRQWNBOztNQUNGLEtBQUssVUFBTDtRQUNFTCxVQUFVLEdBQUc7VUFDWE8sUUFBUSxFQUFFO1lBQ1JMLFFBQVEsRUFBRTtjQUNSTSxXQUFXLEVBQUU7Z0JBQ1hKLE9BQU8sRUFBRWQsT0FBTyxDQUFDa0IsV0FETjtnQkFFWEgsV0FBVyxFQUFFO2NBRkYsQ0FETDtjQUtSSSxVQUFVLEVBQUU7Z0JBQ1ZMLE9BQU8sRUFBRWQsT0FBTyxDQUFDbUIsVUFEUDtnQkFFVkosV0FBVyxFQUFFO2NBRkg7WUFMSjtVQURGO1FBREMsQ0FBYjtRQWNBOztNQUNGLEtBQUssS0FBTDtRQUNFTCxVQUFVLEdBQUc7VUFDWFUsR0FBRyxFQUFFO1lBQ0hSLFFBQVEsRUFBRTtjQUNSSSxTQUFTLEVBQUU7Z0JBQ1RGLE9BQU8sRUFBRUwsUUFEQTtnQkFFVE0sV0FBVyxFQUFFO2NBRko7WUFESDtVQURQO1FBRE0sQ0FBYjtRQVVBO0lBNUNKOztJQStDQSxPQUFPO01BQ0xULElBQUksRUFBRUEsSUFERDtNQUVMZSxZQUFZLEVBQUVYO0lBRlQsQ0FBUDtFQUlEOztFQUVEWSwyQkFBMkIsQ0FBQ0MsV0FBRCxFQUFjO0lBQ3ZDLEtBQUssSUFBSWIsVUFBVCxJQUF1QmEsV0FBVyxDQUFDRixZQUFuQyxFQUFpRDtNQUMvQ0UsV0FBVyxDQUFDYixVQUFELENBQVgsR0FBMEI7UUFDeEJFLFFBQVEsRUFBRTtNQURjLENBQTFCOztNQUdBLEtBQUssSUFBSVksT0FBVCxJQUFvQkQsV0FBVyxDQUFDRixZQUFaLENBQXlCWCxVQUF6QixFQUFxQ0UsUUFBekQsRUFBbUU7UUFDakVXLFdBQVcsQ0FBQ2IsVUFBRCxDQUFYLENBQXdCRSxRQUF4QixDQUFpQ2EsSUFBakMsQ0FBc0M7VUFDcENDLGFBQWEsRUFBRUYsT0FEcUI7VUFFcENHLFFBQVEsRUFDTkosV0FBVyxDQUFDRixZQUFaLENBQXlCWCxVQUF6QixFQUFxQ0UsUUFBckMsQ0FBOENZLE9BQTlDLEVBQXVEVixPQUhyQjtVQUlwQ0MsV0FBVyxFQUNUUSxXQUFXLENBQUNGLFlBQVosQ0FBeUJYLFVBQXpCLEVBQXFDRSxRQUFyQyxDQUE4Q1ksT0FBOUMsRUFBdURUO1FBTHJCLENBQXRDO01BT0Q7SUFDRjs7SUFFRCxPQUFPUSxXQUFXLENBQUNGLFlBQW5CO0lBQ0EsT0FBT0UsV0FBUDtFQUNEOztFQUVESywrQkFBK0IsQ0FBQ0MsMEJBQUQsRUFBNkI7SUFDMUQsT0FBUUMsUUFBRCxJQUFjO01BQ25CQSxRQUFRLENBQUNDLEtBQVQsR0FBaUJELFFBQVEsQ0FBQ0UsV0FBMUI7TUFDQUYsUUFBUSxDQUFDRyxVQUFULEdBQXNCSCxRQUFRLENBQUNJLElBQS9COztNQUNBLEtBQUssSUFBSUMsQ0FBVCxJQUFjTCxRQUFRLENBQUNNLFNBQVQsQ0FBbUJDLFlBQWpDLEVBQStDO1FBQzdDUCxRQUFRLENBQUNNLFNBQVQsQ0FBbUJDLFlBQW5CLENBQWdDRixDQUFoQyxJQUFxQ04sMEJBQTBCLENBQzdEQyxRQUFRLENBQUNNLFNBQVQsQ0FBbUJDLFlBQW5CLENBQWdDRixDQUFoQyxDQUQ2RCxDQUEvRDtNQUdEOztNQUVELE9BQU9MLFFBQVA7SUFDRCxDQVZEO0VBV0Q7RUFFRDtBQUNGO0FBQ0E7OztFQUNFUSxNQUFNLENBQUNoQyxJQUFELEVBQU9DLElBQVAsRUFBYUMsU0FBYixFQUF3QkMsUUFBeEIsRUFBa0NULE9BQWxDLEVBQTJDdUMsUUFBM0MsRUFBcUQ7SUFDekQsSUFBSUMsTUFBTSxHQUFHLEVBQWI7SUFDQSxJQUFJQyxjQUFjLEdBQUcsSUFBckI7O0lBRUEsSUFBSUMsU0FBUyxDQUFDQyxNQUFWLEdBQW1CLENBQXZCLEVBQTBCO01BQ3hCSCxNQUFNLEdBQUdJLElBQUksQ0FBQ0MsU0FBTCxDQUNQLEtBQUt4Qyx1QkFBTCxDQUE2QkMsSUFBN0IsRUFBbUNDLElBQW5DLEVBQXlDQyxTQUF6QyxFQUFvREMsUUFBcEQsRUFBOERULE9BQTlELENBRE8sQ0FBVDtNQUdBeUMsY0FBYyxHQUFHLEtBQUtuQiwyQkFBdEI7SUFDRCxDQUxELE1BS087TUFDTGtCLE1BQU0sR0FBR0ksSUFBSSxDQUFDQyxTQUFMLENBQWV2QyxJQUFmLENBQVQ7TUFDQWlDLFFBQVEsR0FBR2hDLElBQVg7SUFDRDs7SUFFRCxJQUFNdUMsYUFBYSxhQUFNLEtBQUs3QyxLQUFMLENBQVc4QyxNQUFqQixjQUEyQixLQUFLOUMsS0FBTCxDQUFXK0MsU0FBdEMsQ0FBbkI7SUFFQSxJQUFJQyxNQUFNLEdBQUc7TUFDWEMsSUFBSSxFQUFFLEtBQUtsRCxPQUFMLENBQWFtRCxPQUFiLElBQXdCLGVBRG5CO01BRVhDLElBQUksRUFBRXhELEdBQUcsQ0FBQ0MsSUFGQztNQUdYd0QsTUFBTSxFQUFFLE1BSEc7TUFJWEMsSUFBSSxFQUFFZCxNQUpLO01BS1hlLE9BQU8sRUFBRTtRQUNQLGdCQUFnQixrQkFEVDtRQUVQQyxhQUFhLGtCQUFXQyxNQUFNLENBQUNDLElBQVAsQ0FBWVosYUFBWixFQUEyQmEsUUFBM0IsQ0FBb0MsUUFBcEMsQ0FBWDtNQUZOO0lBTEUsQ0FBYjtJQVdBLEtBQUszRCxPQUFMLENBQWE0RCxVQUFiLENBQXdCQyxPQUF4QixDQUNFWixNQURGLEVBRUVWLFFBRkYsRUFHRUEsUUFIRixFQUlFLEtBSkYsRUFLRUUsY0FMRjtFQU9EO0VBRUQ7QUFDRjtBQUNBOzs7RUFDRXFCLEdBQUcsQ0FBQ3RCLE1BQUQsRUFBU0QsUUFBVCxFQUErQjtJQUFBLElBQVp3QixFQUFZLHVFQUFQLEtBQU87SUFDaEMsSUFBTWpCLGFBQWEsYUFBTSxLQUFLN0MsS0FBTCxDQUFXOEMsTUFBakIsY0FBMkIsS0FBSzlDLEtBQUwsQ0FBVytDLFNBQXRDLENBQW5CO0lBQ0EsSUFBSVAsY0FBYyxHQUFHLElBQXJCOztJQUVBLElBQUksT0FBT0QsTUFBUCxLQUFrQixRQUF0QixFQUFnQztNQUM5QkMsY0FBYyxHQUFHLEtBQUtuQiwyQkFBdEI7SUFDRCxDQUZELE1BRU87TUFDTG1CLGNBQWMsR0FBRyxLQUFLYiwrQkFBTCxDQUNmLEtBQUtOLDJCQURVLENBQWpCO0lBR0Q7O0lBRUQsSUFBSXlDLEVBQUosRUFBUTtNQUNOdEIsY0FBYyxHQUFHLElBQWpCO0lBQ0Q7O0lBRUQsSUFBSVEsTUFBTSxHQUFHO01BQ1hDLElBQUksRUFBRSxLQUFLbEQsT0FBTCxDQUFhbUQsT0FBYixJQUF3QixlQURuQjtNQUVYQyxJQUFJLEVBQUVZLGNBQUEsQ0FBTUMsbUJBQU4sQ0FBMEJyRSxHQUFHLENBQUNDLElBQTlCLEVBQW9DMkMsTUFBcEMsQ0FGSztNQUdYYSxNQUFNLEVBQUUsS0FIRztNQUlYQyxJQUFJLEVBQUVZLFNBSks7TUFLWFgsT0FBTyxFQUFFO1FBQ1AsZ0JBQWdCLGtCQURUO1FBRVBDLGFBQWEsa0JBQVdDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZWixhQUFaLEVBQTJCYSxRQUEzQixDQUFvQyxRQUFwQyxDQUFYO01BRk47SUFMRSxDQUFiO0lBV0EsS0FBSzNELE9BQUwsQ0FBYTRELFVBQWIsQ0FBd0JDLE9BQXhCLENBQ0VaLE1BREYsRUFFRVYsUUFGRixFQUdFQSxRQUhGLEVBSUUsS0FKRixFQUtFRSxjQUxGO0VBT0Q7RUFFRDtBQUNGO0FBQ0E7OztFQUNFMEIsTUFBTSxDQUFDQyxLQUFELEVBQVE5RCxJQUFSLEVBQWNDLElBQWQsRUFBb0JDLFNBQXBCLEVBQStCQyxRQUEvQixFQUF5Q1QsT0FBekMsRUFBa0R1QyxRQUFsRCxFQUE0RDtJQUNoRSxJQUFJQyxNQUFNLEdBQUcsRUFBYjtJQUNBLElBQUlDLGNBQWMsR0FBRyxJQUFyQjs7SUFDQSxJQUFJQyxTQUFTLENBQUNDLE1BQVYsR0FBbUIsQ0FBdkIsRUFBMEI7TUFDeEJILE1BQU0sR0FBR0ksSUFBSSxDQUFDQyxTQUFMLENBQ1AsS0FBS3hDLHVCQUFMLENBQTZCQyxJQUE3QixFQUFtQ0MsSUFBbkMsRUFBeUNDLFNBQXpDLEVBQW9EQyxRQUFwRCxFQUE4RFQsT0FBOUQsQ0FETyxDQUFUO01BR0F5QyxjQUFjLEdBQUcsS0FBS25CLDJCQUF0QjtJQUNELENBTEQsTUFLTztNQUNMa0IsTUFBTSxHQUFHSSxJQUFJLENBQUNDLFNBQUwsQ0FBZXZDLElBQWYsQ0FBVDtNQUNBaUMsUUFBUSxHQUFHaEMsSUFBWDtJQUNEOztJQUVELElBQU11QyxhQUFhLGFBQU0sS0FBSzdDLEtBQUwsQ0FBVzhDLE1BQWpCLGNBQTJCLEtBQUs5QyxLQUFMLENBQVcrQyxTQUF0QyxDQUFuQjtJQUVBLElBQUlDLE1BQU0sR0FBRztNQUNYQyxJQUFJLEVBQUUsS0FBS2xELE9BQUwsQ0FBYW1ELE9BQWIsSUFBd0IsZUFEbkI7TUFFWEMsSUFBSSxZQUFLeEQsR0FBRyxDQUFDQyxJQUFULGNBQWlCdUUsS0FBakIsQ0FGTztNQUdYZixNQUFNLEVBQUUsS0FIRztNQUlYQyxJQUFJLEVBQUVkLE1BSks7TUFLWGUsT0FBTyxFQUFFO1FBQ1AsZ0JBQWdCLGtCQURUO1FBRVBDLGFBQWEsa0JBQVdDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZWixhQUFaLEVBQTJCYSxRQUEzQixDQUFvQyxRQUFwQyxDQUFYO01BRk47SUFMRSxDQUFiO0lBV0EsS0FBSzNELE9BQUwsQ0FBYTRELFVBQWIsQ0FBd0JDLE9BQXhCLENBQ0VaLE1BREYsRUFFRVYsUUFGRixFQUdFQSxRQUhGLEVBSUUsS0FKRixFQUtFRSxjQUxGO0VBT0Q7RUFFRDtBQUNGO0FBQ0E7OztFQUNFNEIsTUFBTSxDQUFDRCxLQUFELEVBQVE3QixRQUFSLEVBQWtCO0lBQ3RCLElBQU1PLGFBQWEsYUFBTSxLQUFLN0MsS0FBTCxDQUFXOEMsTUFBakIsY0FBMkIsS0FBSzlDLEtBQUwsQ0FBVytDLFNBQXRDLENBQW5CO0lBRUEsSUFBSUMsTUFBTSxHQUFHO01BQ1hDLElBQUksRUFBRSxLQUFLbEQsT0FBTCxDQUFhbUQsT0FBYixJQUF3QixlQURuQjtNQUVYQyxJQUFJLFlBQUt4RCxHQUFHLENBQUNDLElBQVQsY0FBaUJ1RSxLQUFqQixDQUZPO01BR1hmLE1BQU0sRUFBRSxRQUhHO01BSVhDLElBQUksRUFBRSxJQUpLO01BS1hDLE9BQU8sRUFBRTtRQUNQLGdCQUFnQixrQkFEVDtRQUVQQyxhQUFhLGtCQUFXQyxNQUFNLENBQUNDLElBQVAsQ0FBWVosYUFBWixFQUEyQmEsUUFBM0IsQ0FBb0MsUUFBcEMsQ0FBWDtNQUZOO0lBTEUsQ0FBYjtJQVdBLEtBQUszRCxPQUFMLENBQWE0RCxVQUFiLENBQXdCQyxPQUF4QixDQUFnQ1osTUFBaEMsRUFBd0NWLFFBQXhDO0VBQ0Q7O0FBcFBPOztlQXVQSzNDLEcifQ==